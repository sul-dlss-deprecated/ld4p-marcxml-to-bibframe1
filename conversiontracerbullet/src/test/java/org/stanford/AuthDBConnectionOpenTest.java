package org.stanford;

import oracle.jdbc.pool.OracleDataSource;
import org.junit.Ignore;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.powermock.core.classloader.annotations.PrepareForTest;
import org.powermock.modules.junit4.PowerMockRunner;

import java.sql.Connection;

import static org.easymock.EasyMock.expect;
import static org.powermock.api.easymock.PowerMock.createMock;
import static org.powermock.api.easymock.PowerMock.replay;

@RunWith(PowerMockRunner.class)
@PrepareForTest({ AuthDBConnection.class })
public class AuthDBConnectionOpenTest {

    @Ignore("Crashing, see https://github.com/powermock/powermock/issues/743")
    @Test
    public void testOpen() throws Exception {
        createMocksAndSetExpectations();
        AuthDBConnection.open();
    }

    private void createMocksAndSetExpectations() throws Exception {
        Connection mockConnection = createMock(Connection.class);
        OracleDataSource mockDS = createMock(OracleDataSource.class);
        expect(mockDS.getConnection()).andReturn(mockConnection);
        expect(new OracleDataSource()).andReturn(mockDS);
        replay(OracleDataSource.class);
    }
}